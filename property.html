<!doctype html>
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Property | Rageo Rentals</title>
  <meta name="description" content="Loading property..." />
  <link rel="canonical" href="https://rageoproperties.com/">

  <style>
    :root {
      --accent:#007bff;
      --muted:#666;
      --bg:#fafafa;
    }
    body {
      font-family: Arial, system-ui, -apple-system;
      max-width: 1000px;
      margin: 18px auto;
      padding: 12px;
      color: #222;
      background: var(--bg);
    }

    header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    header img { height: 56px; }

    h1 { margin: 6px 0; font-size: 1.4rem; }
    .meta { color: var(--muted); margin-bottom: 10px; }

    .grid {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 18px;
      align-items: start;
    }

    /* ---- Gallery ---- */
    .gallery {
      background: #fff;
      padding: 8px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      position: relative;
    }
    .gallery .main img {
      width: 100%;
      max-height: 520px;
      object-fit: contain;
      background: #000;
      border-radius: 6px;
      cursor: zoom-in;
      transition: transform 0.3s ease;
    }

    /* Thumbnails */
    .thumbs {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      overflow-x: auto;
    }
    .thumbs img {
      width: 84px;
      height: 64px;
      object-fit: cover;
      border-radius: 6px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.2s;
    }
    .thumbs img.active { border-color: var(--accent); }

    /* ---- Info & description ---- */
    .info {
      background: #fff;
      padding: 14px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .price {
      font-size: 1.25rem;
      font-weight: 700;
      margin: 6px 0;
      color: #111;
    }
    .location { color: var(--muted); }

    .desc {
      margin-top: 12px;
      line-height: 1.5;
      background: #fff;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }

    /* ---- Buttons ---- */
    .actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
    .btn {
      display: inline-block;
      padding: 10px 14px;
      border-radius: 6px;
      color: white;
      text-decoration: none;
      font-weight: 700;
      border: none;
      cursor: pointer;
    }
    .btn-call { background: #28a745; }
    .btn-copy { background: var(--accent); }
    .small { font-size: 0.9rem; color: var(--muted); }

    /* ---- Lightbox (fullscreen image) ---- */
    .lightbox {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .lightbox img {
      max-width: 95%;
      max-height: 90%;
      object-fit: contain;
      border-radius: 8px;
    }
    .lightbox.active {
      display: flex;
    }

    footer {
      margin-top: 22px;
      color: var(--muted);
      text-align: center;
    }

    @media (max-width:880px){
      .grid { grid-template-columns: 1fr; }
      .gallery .main img { max-height: 340px; }
    }
  </style>
</head>
<body>
  <header>
    <img src="/logo.jpg" alt="Rageo Rentals logo">
    <div>
      <div style="font-weight:700;color:#333">Rageo Rentals</div>
      <div class="small">Verified houses for rent in Kenya</div>
    </div>
  </header>

  <main>
    <div id="content">
      <p class="small" id="loading">Loading property…</p>
    </div>
  </main>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox">
    <img id="lightboxImg" src="" alt="Property image">
  </div>

  <footer>
    <p class="small">© 2025 Rageo Properties</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBOoGvZDvzp-CHLVllJAujTdo84vxcz_hM",
      authDomain: "rageo-rentals.firebaseapp.com",
      projectId: "rageo-rentals",
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function getParam(name){
      return new URL(location.href).searchParams.get(name);
    }

    function cloudinaryThumb(url, w=1200, h=800){
      if (!url) return url;
      return url.replace('/upload/', `/upload/w_${w},h_${h},c_fill/`);
    }

    async function renderProperty(id){
      const container = document.getElementById('content');
      const loading = document.getElementById('loading');
      if (loading) loading.remove();

      const ref = doc(db, 'listings', id);
      const snap = await getDoc(ref);
      if (!snap.exists()){
        container.innerHTML = '<p>Property not found.</p>';
        return;
      }
      const data = snap.data();
      document.title = (data.title || 'Property') + ' | Rageo Rentals';

      const images = Array.isArray(data.images) && data.images.length ? data.images : [];

      const grid = document.createElement('div');
      grid.className = 'grid';

      // ---- Left side ----
      const left = document.createElement('div');
      const galleryBox = document.createElement('div');
      galleryBox.className = 'gallery';

      const mainWrap = document.createElement('div');
      mainWrap.className = 'main';
      const mainImg = document.createElement('img');
      mainImg.src = cloudinaryThumb(images[0],1200,800);
      mainWrap.appendChild(mainImg);
      galleryBox.appendChild(mainWrap);

      // thumbs
      if (images.length > 1){
        const thumbs = document.createElement('div');
        thumbs.className = 'thumbs';
        images.forEach((src,i)=>{
          const t = document.createElement('img');
          t.src = cloudinaryThumb(src,300,200);
          if(i===0) t.classList.add('active');
          t.onclick=()=>{
            mainImg.src = cloudinaryThumb(src,1200,800);
            thumbs.querySelectorAll('img').forEach(x=>x.classList.remove('active'));
            t.classList.add('active');
          };
          thumbs.appendChild(t);
        });
        galleryBox.appendChild(thumbs);
      }

      left.appendChild(galleryBox);

      const descBox = document.createElement('div');
      descBox.className = 'desc';
      descBox.innerHTML = `
        <h2>${data.title || ''}</h2>
        <p class="small">${data.location || ''}</p>
        <p>${data.description || ''}</p>
      `;
      left.appendChild(descBox);

      // ---- Right side ----
      const right = document.createElement('aside');
      right.className = 'info';
      right.innerHTML = `
        <div class="location">${data.location || ''}</div>
        <div class="price">${data.price || 'Contact for price'}</div>
      `;
      const actions = document.createElement('div');
      actions.className = 'actions';
      const callBtn = document.createElement('a');
      callBtn.href='tel:+254726028077';
      callBtn.className='btn btn-call';
      callBtn.textContent='Call Office';
      const copyBtn = document.createElement('button');
      copyBtn.className='btn btn-copy';
      copyBtn.textContent='Copy link';
      actions.appendChild(callBtn);
      actions.appendChild(copyBtn);
      right.appendChild(actions);

      const shareInput = document.createElement('input');
      shareInput.type='text';
      shareInput.value=`${location.origin}${location.pathname}?id=${id}`;
      shareInput.readOnly=true;
      shareInput.style='display:none;width:100%;margin-top:8px;padding:6px;';
      right.appendChild(shareInput);

      copyBtn.onclick=()=>{
        shareInput.style.display='block';
        shareInput.select();
        document.execCommand('copy');
        copyBtn.textContent='Copied!';
        setTimeout(()=>{copyBtn.textContent='Copy link'; shareInput.style.display='none';},2000);
      };

      grid.appendChild(left);
      grid.appendChild(right);
      container.appendChild(grid);

      // ---- Lightbox click ----
      const lightbox = document.getElementById('lightbox');
      const lightboxImg = document.getElementById('lightboxImg');
      mainImg.addEventListener('click', ()=>{
        lightboxImg.src = mainImg.src;
        lightbox.classList.add('active');
      });
      lightbox.addEventListener('click', ()=> lightbox.classList.remove('active'));
    }

    const id = getParam('id');
    if (id) renderProperty(id);
    else document.getElementById('content').innerHTML = '<p>No property specified.</p>';
  </script>
</body>
</html>

